---
title: "GOMAXPROCS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏≠‡∏á DevOps"
subtitle: ""
date: 2023-08-13T00:19:58+07:00
lastmod: 2023-08-13T00:19:58+07:00
draft: false
author: "Kawin Viriyaprasopsook"
authorLink: "https://kawin-vir.pages.dev"
description: "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ GOMAXPROCS ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏¥‡∏î"
license: ""
images: []
resources:
- name: "featured-image"
  src: "go-featured-image.png"
- name: "featured-image-preview"
  src: "go-featured-image.webp"

tags: ["Go", "Programing", "DevOps"]
categories: ["Programing"]

lightgallery: true
---

‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà Go 1.5 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡∏°‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô `User-Level` ‡∏ó‡∏µ‡πà Go App ‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Instance ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏î‡πâ‡∏ß‡∏¢ GOMAXPROCS ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á GOMAXPROCS ‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏ô‡∏µ‡πâ
{{< admonition note "Note" >}}
GOMAXPROCS sets the maximum number of CPUs that can be executing simultaneously and returns the previous setting. It defaults to the value of runtime.NumCPU. If n < 1, it does not change the current setting. This call will go away when the scheduler improves.
{{< /admonition >}}
<!--more-->

## ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡∏π
‡∏ã‡∏∂‡πà‡∏á‡∏Å‡πá‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏à‡∏∞‡∏î‡∏π‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏°‡∏î‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö `Parallelism` (‡∏Ñ‡∏ô‡∏•‡∏∞‡∏≠‡∏±‡∏ô‡∏Å‡∏±‡∏ö `Concurrency` ‡∏ô‡∏∞ Concurrency ‡∏Ñ‡∏∑‡∏≠ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô**‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô** Parallelism ‡∏Ñ‡∏∑‡∏≠ **‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô**) ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô `logical CPU` ‡πÅ‡∏ï‡πà‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏õ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô `Container` ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏≥‡∏´‡∏ô‡∏î `CPU quota` ‡πÑ‡∏ß‡πâ (‡∏ã‡∏∂‡πà‡∏á‡∏Å‡πá‡∏õ‡∏Å‡∏ï‡∏¥ Ops ‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡πÄ‡∏ö‡∏µ‡∏¢‡∏î‡∏Å‡∏±‡∏ö services ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) ‡πÅ‡∏≠‡∏õ‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏ô‡∏î‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ GOMAXPROCS ‡∏î‡πâ‡∏ß‡∏¢ CPU quota ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å container ‡∏ô‡∏µ‡πà‡∏™‡∏¥ ‡∏î‡∏π‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Go fiber ‡∏Ç‡∏∂‡πâ‡∏°‡∏°‡∏≤‡πÅ‡∏≠‡∏õ‡∏ô‡∏∂‡∏á ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö [Prefork](https://github.com/gofiber/fiber/issues/180)

```go
func main() {

	// init fiber app
	app := fiber.New(fiber.Config{
		Prefork: true,
	})

	// simple get current CPU and Go MaxProcs
	app.Get("/", func(ctx *fiber.Ctx) error {
		respBody := fiber.Map{
			"NumCPU":     runtime.NumCPU(),
			"GOMAXPROCS": runtime.GOMAXPROCS(0),
		}
		return ctx.JSON(respBody)
	})

	// listen HTTP
	go func() {
		if err := app.Listen(":8080"); err != nil {
			log.Panic(err)
		}
	}()

	// listen for end signal
	quit := make(chan os.Signal, 1)
	signal.Notify(quit, os.Interrupt, syscall.SIGTERM)

	// block before gracefully shutdown
	<-quit
	fmt.Println("Gracefully shutting down...")
	_ = app.Shutdown()
}
```

‡πÅ‡∏≠‡∏õ‡∏£‡∏±‡∏ô‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ 16 logical CPU cores
![system](img/system.webp "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö")

Fiber app ‡∏Å‡πá‡∏à‡∏∞‡∏á‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å ‡πÜ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ 16 processes
![from_start](img/from_start.webp "‡∏£‡∏±‡∏ô‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á")

‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏•‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏ú‡πà‡∏≤‡∏ô Container ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î CPU quota ‡∏î‡∏π
![docker_from_start](img/docker_from_start.webp "‡∏£‡∏±‡∏ô‡∏ö‡∏ô Container ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î CPU quota")

‡∏ß‡πâ‡∏≠‡∏ó‡∏ó‡∏ó ‡∏°‡∏±‡∏ô‡∏Å‡πá‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏°‡∏µ 16 processes ‡∏õ‡∏£‡∏≤‡∏Å‡∏é‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏Å‡πá‡∏¢‡∏±‡∏á‡∏á‡∏≠‡∏Å process ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ quota ‡πÑ‡∏ß‡πâ

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£
‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡∏ô‡∏µ‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£ ‡∏°‡∏±‡∏ô‡∏Å‡πá‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏ô‡∏¥‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡∏á‡∏≠‡∏Å process ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏â‡∏¢ ‡πÜ  ‡πÅ‡∏ï‡πà‡∏•‡∏≠‡∏á‡∏ô‡∏∂‡∏Å‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô 2 ‡∏Ñ‡∏ô ‡πÅ‡∏ï‡πà‡πÄ‡∏≠‡∏≤‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î 16 ‡∏Ñ‡∏ô ‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏ó‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß**‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô**‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£‡∏Ç‡∏∂‡πâ‡∏ô ‡πÉ‡∏ä‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡∏°‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠ latency ‡∏ô‡∏±‡πà‡∏ô‡πÅ‡∏´‡∏•‡∏∞ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ `CPU throttling` ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤‡∏•‡∏á‡πÑ‡∏õ ‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏≤‡∏ü‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà CPU ‡πÇ‡∏î‡∏ô‡∏ö‡∏µ‡∏ö‡∏•‡∏á‡∏°‡∏≤ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏ô‡∏•‡πâ‡∏ô quota ‡πÇ‡∏î‡∏¢‡πÇ‡∏î‡∏ô‡∏Å‡∏î‡∏•‡∏á‡∏°‡∏≤‡∏à‡∏ô‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ limit ‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏•‡∏¢
![cpu_throttling](img/cpu_throttling.webp "cpu throttling")

## ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ
### ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ú‡πà‡∏≤‡∏ô GOMAXPROCS
‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏°‡∏≤‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î GOMAXPROCS ‡∏°‡∏±‡∏ô‡πÄ‡∏•‡∏¢‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πà‡πÅ‡∏´‡∏•‡∏∞
```go
func main() {
  runtime.GOMAXPROCS(4)

  ...
}
```
‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô `runtime.GOMAXPROCS()` ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô‡πÉ‡∏ô container ‡∏î‡∏π
![docker_from_manual](img/docker_from_manual.webp "‡∏£‡∏±‡∏ô‡∏ö‡∏ô Container ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î CPU quota")
‡∏Å‡πá‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ process ‡∏á‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏Å‡πá‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á container ‡∏≠‡∏¢‡∏π‡πà‡∏î‡∏µ

### ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ú‡πà‡∏≤‡∏ô uber-go/automaxprocs
‡∏à‡∏∂‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡∏Ç‡∏±‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ ‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠ uber ‡∏ô‡∏±‡πà‡∏ô‡πÄ‡∏≠‡∏á [uber-go/automaxprocs](https://github.com/uber-go/automaxprocs) ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏Å‡πá‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏Ñ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° import pkg ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô main ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
```go
import (
  _ "go.uber.org/automaxprocs"
)

func main() {
  ...
}
```

‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô CPU quota ‡πÄ‡∏•‡∏¢ ‡∏ó‡∏µ‡∏ô‡∏µ‡πâ‡πÅ‡∏≠‡∏õ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏∞‡∏á‡∏≠‡∏Å process ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô CPU quota ‡∏Ç‡∏≠‡∏á container ‡πÅ‡∏≠‡∏õ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏î‡∏ô CPU throttling ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à ü§£
![docker_from_auto](img/docker_from_auto.webp "‡∏£‡∏±‡∏ô‡∏ö‡∏ô Container ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î CPU quota")